<!DOCTYPE HTML>
<html>
  <head>
    <script src='https://cdn.firebase.com/v0/firebase.js'></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"> </script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <style>
      .dice-roll{
        width: 50px;
      }

      .chart div {
        font: 10px sans-serif;
        background-color: steelblue;
        text-align: right;
        padding: 3px;
        margin: 1px;
        color: white;
      }
    </style>
  </head>
  <body>
    <button class="dice-roll" value="1" type="button"><h3>1</h3></button>
    <button class="dice-roll" value="2" type="button"><h3>2</h3></button>
    <button class="dice-roll" value="3" type="button"><h3>3</h3></button>
    <button class="dice-roll" value="4" type="button"><h3>4</h3></button>
    <button class="dice-roll" value="5" type="button"><h3>5</h3></button>
    <button class="dice-roll" value="6" type="button"><h3>6</h3></button>
    <button class="dice-roll" value="7" type="button"><h3>7</h3></button>
    <button class="dice-roll" value="8" type="button"><h3>8</h3></button>
    <button class="dice-roll" value="9" type="button"><h3>9</h3></button>
    <button class="dice-roll" value="10" type="button"><h3>10</h3></button>
    <button class="dice-roll" value="11" type="button"><h3>11</h3></button>
    <button class="dice-roll" value="12" type="button"><h3>12</h3></button>

    <div id="output">

    </div>


    <div id="chart_div" style="width: 900px; height: 500px;"></div>


    <script>
      var allRolls = [];
      var aggregatedRolls = [];
      var high = 12;

      //init google chart
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);

      function numberOfOccurrences(arr, num){
          
        count = 0;

        for (var i = 0; i < arr.length; i++){
          if (arr[i] == num){
            count++;
          }
        }


        return count;
      }

      function getAggregatedCounts(allDiceRolls, highestDiceNumber){
        var aggregatedRolls = [['Dice Roll', 'Actual Value', 'Expected Value']];


        for (var i = 0; i < highestDiceNumber; i++){
          roll = i + 1;
          actual = numberOfOccurrences(allDiceRolls, roll);

          expected = actual + 1; //TODO: calculate
          aggregatedRolls.push([roll, actual, expected]);
        }

        return aggregatedRolls;
      }

      function drawChart() {
        agg = getAggregatedCounts(allRolls, high);
        var data = google.visualization.arrayToDataTable(agg);

        var options = {
          title: 'Company Performance',
          chartArea: {left: 50}
        };

        var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
        chart.draw(data, options);
      }

      var rootRef = new Firebase('https://catancount.firebaseio.com/');
      var rollsList = new Firebase('https://catancount.firebaseio.com/rolls');

      var startingCount = Number.MAX_VALUE;

      // get starting length of the list
      // which will be > 0 if there is data and the page is reloaded
      rollsList.once('value', function(dataSnapshot) {
        startingCount = dataSnapshot.numChildren();
      });

      rollsList.on('child_added', function(snapshot) {
        var msgData = snapshot.val();
        $('#output').append(msgData + " ");
        allRolls.push(msgData);

        drawChart();
      });


      $('.dice-roll').click(function() {
        _this = $(this);
        val = _this.val();
        rollsList.push(val);
      });

    </script>
  </body>
</html>
